@inherits LayoutComponentBase
@inject AdminApiClient AdminApi

<input type="checkbox" id="sidebar-collapse-toggle" class="sidebar-collapse-checkbox" />

<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4">
            <span class="text-muted">Hello, @(currentDisplayName ?? Environment.UserName)</span>
            <div class="d-flex gap-2 align-items-center">
                <LanguageSelector />
                <ThemeToggle />
            </div>
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

@code {
    private string? currentDisplayName;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var username = Environment.UserName;
            var user = await AdminApi.GetUserByUsernameAsync(username);
            if (user != null && !string.IsNullOrWhiteSpace(user.DisplayName))
            {
                currentDisplayName = user.DisplayName;
            }
        }
        catch
        {
            // Ignore errors and fall back to Environment.UserName
        }
    }
}

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>
